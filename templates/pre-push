#!/bin/bash
# Pre-push hook for Mauscribe
# Runs before git push to perform basic checks and validations

echo "ğŸ” Pre-push hook triggered - Running basic checks..."

# Get the current directory (repository root)
REPO_ROOT="$(git rev-parse --show-toplevel)"
cd "$REPO_ROOT"

# Check if we're on a protected branch
CURRENT_BRANCH=$(git branch --show-current)
PROTECTED_BRANCHES=("main" "master" "develop")

for branch in "${PROTECTED_BRANCHES[@]}"; do
    if [[ "$CURRENT_BRANCH" == "$branch" ]]; then
        echo "âš ï¸  Warning: Pushing to protected branch '$CURRENT_BRANCH'"
        echo "ğŸ’¡ Make sure your changes are reviewed and tested"
        echo ""
    fi
done

# Check if there are uncommitted changes
if ! git diff-index --quiet HEAD --; then
    echo "âš ï¸  Warning: You have uncommitted changes"
    echo "ğŸ’¡ Consider committing or stashing them before pushing"
    echo ""
fi

# Check if basic test files exist (without running them)
if [ -f "run_tests.py" ]; then
    echo "ğŸ§ª Test runner found: run_tests.py"
    echo "ğŸ’¡ Run 'python run_tests.py' manually to test your code"
    echo ""
fi

# Check if linting config exists (without running it)
if [ -f ".pre-commit-config.yaml" ]; then
    echo "ğŸ” Pre-commit config found: .pre-commit-config.yaml"
    echo "ğŸ’¡ Run 'pre-commit run --all-files' manually to check code quality"
    echo ""
fi

echo "âœ… Pre-push checks completed successfully"
echo "ğŸš€ Ready to push!"
echo ""
echo "ğŸ’¡ Tip: Run tests and linting manually when needed:"
echo "   - Tests: python run_tests.py"
echo "   - Linting: pre-commit run --all-files"
