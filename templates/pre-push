#!/bin/bash
# Pre-push hook for Mauscribe
# Runs before git push to perform basic checks and validations

echo "🔍 Pre-push hook triggered - Running basic checks..."

# Get the current directory (repository root)
REPO_ROOT="$(git rev-parse --show-toplevel)"
cd "$REPO_ROOT"

# Check if we're on a protected branch
CURRENT_BRANCH=$(git branch --show-current)
PROTECTED_BRANCHES=("main" "master" "develop")

for branch in "${PROTECTED_BRANCHES[@]}"; do
    if [[ "$CURRENT_BRANCH" == "$branch" ]]; then
        echo "⚠️  Warning: Pushing to protected branch '$CURRENT_BRANCH'"
        echo "💡 Make sure your changes are reviewed and tested"
        echo ""
    fi
done

# Check if there are uncommitted changes
if ! git diff-index --quiet HEAD --; then
    echo "⚠️  Warning: You have uncommitted changes"
    echo "💡 Consider committing or stashing them before pushing"
    echo ""
fi

# Check if basic test files exist (without running them)
if [ -f "run_tests.py" ]; then
    echo "🧪 Test runner found: run_tests.py"
    echo "💡 Run 'python run_tests.py' manually to test your code"
    echo ""
fi

# Check if linting config exists (without running it)
if [ -f ".pre-commit-config.yaml" ]; then
    echo "🔍 Pre-commit config found: .pre-commit-config.yaml"
    echo "💡 Run 'pre-commit run --all-files' manually to check code quality"
    echo ""
fi

echo "✅ Pre-push checks completed successfully"
echo "🚀 Ready to push!"
echo ""
echo "💡 Tip: Run tests and linting manually when needed:"
echo "   - Tests: python run_tests.py"
echo "   - Linting: pre-commit run --all-files"
